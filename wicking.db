PRAGMA foreign_keys=ON;
PRAGMA journal_mode=WAL;
PRAGMA synchronous=NORMAL;

-- Entities
CREATE TABLE IF NOT EXISTS specimens (
  id           INTEGER PRIMARY KEY,
  specimen_description  TEXT,
  sku          TEXT,
  style        TEXT,
  size_weight  TEXT,
  color        TEXT
);

CREATE TABLE IF NOT EXISTS clients (
  id                INTEGER PRIMARY KEY,
  company_name      TEXT NOT NULL,
  buyer             TEXT,
  company_address   TEXT,
  phone_number      TEXT,
  email             TEXT,
  country_of_origin TEXT
);

-- Main table
CREATE TABLE IF NOT EXISTS experiments (
  id            INTEGER PRIMARY KEY,
  date_utc      TEXT NOT NULL,      
  specimen_id   INTEGER NOT NULL REFERENCES specimens(id) ON DELETE RESTRICT,
  client_id     INTEGER          REFERENCES clients(id)  ON DELETE SET NULL,
  location_setting      TEXT,
  operator_name TEXT,
  test_results  TEXT
);
CREATE INDEX IF NOT EXISTS idx_experiments_specimen ON experiments(specimen_id);
CREATE INDEX IF NOT EXISTS idx_experiments_client   ON experiments(client_id);

-- Table 2: Vertical Wicking Rate
CREATE TABLE IF NOT EXISTS vertical_wicking_rate (
  id               INTEGER PRIMARY KEY,
  experiment_id    INTEGER NOT NULL REFERENCES experiments(id) ON DELETE CASCADE,
  time_s           REAL    NOT NULL,    -- Time
  height_mm        REAL,                -- Height
  time_uniform_s   REAL,                -- Time_Uniform
  model_height_mm  REAL,                -- Model_Height
  model_wicking    REAL                 -- Model_Wicking
);
CREATE INDEX IF NOT EXISTS idx_wicking_exp_time ON vertical_wicking_rate(experiment_id, time_s);

-- Table 3: Specimen (already modeled as 'specimens' above)

-- Table 4: Client (already modeled as 'clients' above)

-- Table 5: Evaporation (ONE row per experiment; your preferred single-row format)
CREATE TABLE IF NOT EXISTS evaporation (
  id                           INTEGER PRIMARY KEY,
  experiment_id                INTEGER NOT NULL UNIQUE REFERENCES experiments(id) ON DELETE CASCADE,

  frame_weight               REAL,
  frame_weight_time          REAL,

  frame_plus_sample          REAL,
  frame_plus_sample_time     REAL,

  frame_plus_sample_wet      REAL,
  frame_plus_sample_wet_time REAL,

  frame_plus_sample_dry      REAL,
  frame_plus_sample_dry_time REAL
);
CREATE INDEX IF NOT EXISTS idx_evaporation_exp ON evaporation(experiment_id);

-- Table: Absorption (Not sure, only evaporation was discussed)
CREATE TABLE IF NOT EXISTS absorption_measurements (
  id               INTEGER PRIMARY KEY,
  experiment_id    INTEGER NOT NULL REFERENCES experiments(id) ON DELETE CASCADE,
  time_s           REAL    NOT NULL,
  sample_value     REAL,
  note             TEXT
);
CREATE INDEX IF NOT EXISTS idx_absorption_exp_time ON absorption_measurements(experiment_id, time_s);
